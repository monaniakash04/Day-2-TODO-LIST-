<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-Do List</title>
    <script defer>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("taskForm");
        const taskList = document.getElementById("taskList");

        let tasks = [];

        const renderTasks = () => {
          taskList.innerHTML = "";
          tasks.forEach((task, index) => {
            const isOverdue =
              !task.completed && new Date() > new Date(task.time);

            const taskEl = document.createElement("div");
            taskEl.className = `flex items-center justify-between p-3 rounded mb-2 ${
              task.completed
                ? "bg-green-100"
                : isOverdue
                ? "bg-red-100"
                : "bg-gray-100"
            }`;

            taskEl.innerHTML = `
            <div class="flex items-center gap-2">
              <input type="checkbox" class="task-check" data-index="${index}" ${
              task.completed ? "checked" : ""
            }>
              <div>
                <div class="font-medium ${
                  task.completed ? "line-through" : ""
                }">${task.text}</div>
                <div class="text-sm text-gray-600">Due: ${task.time}</div>
              </div>
            </div>
            <div class="flex gap-2">
              <button data-index="${index}" class="edit-btn text-blue-500 hover:underline">Edit</button>
              <button data-index="${index}" class="delete-btn text-red-500 hover:underline">Delete</button>
            </div>
          `;

            taskList.appendChild(taskEl);
          });
        };

        const checkDeadlines = () => {
          tasks.forEach((task, index) => {
            if (
              !task.completed &&
              new Date() > new Date(task.time) &&
              !task.alerted
            ) {
              alert(`Task "${task.text}" is overdue!`);
              task.alerted = true;
            }
          });
          renderTasks();
        };

        setInterval(checkDeadlines, 60000); // check every minute

        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const text = form.task.value.trim();
          const time = form.time.value;
          if (!text || !time) return;

          tasks.push({ text, time, completed: false, alerted: false });
          form.reset();
          renderTasks();
        });

        taskList.addEventListener("click", (e) => {
          const index = e.target.dataset.index;
          if (e.target.classList.contains("delete-btn")) {
            tasks.splice(index, 1);
            renderTasks();
          }

          if (e.target.classList.contains("edit-btn")) {
            const newText = prompt("Edit task", tasks[index].text);
            const newTime = prompt("Edit time", tasks[index].time);
            if (newText && newTime) {
              tasks[index].text = newText;
              tasks[index].time = newTime;
              tasks[index].alerted = false;
              renderTasks();
            }
          }

          if (e.target.classList.contains("task-check")) {
            tasks[index].completed = e.target.checked;
            if (tasks[index].completed) {
              alert(`Task "${tasks[index].text}" marked as completed!`);
            }
            renderTasks();
          }
        });

        renderTasks();
      });
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 min-h-screen p-6">
    <div class="max-w-xl mx-auto bg-white shadow rounded p-6">
      <h1 class="text-2xl font-bold mb-4">📝 To-Do List</h1>
      <form id="taskForm" class="mb-6 space-y-3">
        <input
          type="text"
          name="task"
          placeholder="Enter task..."
          class="w-full border rounded px-3 py-2"
          required
        />
        <input
          type="datetime-local"
          name="time"
          class="w-full border rounded px-3 py-2"
          required
        />
        <button
          type="submit"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >
          Add Task
        </button>
      </form>
      <div id="taskList"></div>
    </div>
  </body>
</html>
